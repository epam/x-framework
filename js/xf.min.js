(function(t,e,a){var n=e("body"),o=t.XF=t.XF||{};o.Events=a.Events,_.extend(o,o.Events),o.navigate=function(t){o.Router.navigate(t,{trigger:!0})},o.on("navigate",o.navigate);var s=/\:/;o.on("all",function(t){if(console.log("XF:all - ",t),console.log(typeof t),s.test(t)){var e=t.split(s);if(!("component"!==e[0]&&3>e.length)){var a=e[1];if(o._defferedCompEvents||(o._defferedCompEvents={}),"component"===e[0]&&"constructed"===e[2]&&onComponentCostruct(a),!o.getComponentByID(a)){var n=o._defferedCompEvents[a]||(o._defferedCompEvents[a]=[]);n.push(t),o.on("component:"+a+":constructed",function(){_.each(n,function(t){o.trigger(t)})})}}}}),onComponentCostruct=function(t){console.log("constructed",t);var a=e(o.getComponentByID(t).selector());o.trigger("pages:start",a),c(a)},o.start=function(t){t=t||{},_.extend(o.Settings.options,t.settings),o.Cache.init(),t.device=t.device||{},o.Device.init(t.device.types),t.router=t.router||{},r(t.router),l(),p(),o.Router.start(),t.animations=t.animations||{},t.animations.default=t.animations.default||"",_.has(o.Device.type,"defaultAnimation")&&(t.animations.default=o.Device.type.defaultAnimation,console.log("Options.animations",t.animations)),o.Pages.init(t.animations),_.has(o,"UI")&&o.UI.init(),c(n)};var r=function(t){if(o.Router)throw"XF.createRouter can be called only ONCE!";o.Router=new(o.RouterClass.extend(t))},l=function(){e("body").on("tap click","[data-href]",function(){var t=e(this).data("animation")||null;t&&o.trigger("pages:animation:next",t),o.Router.navigate(e(this).data("href"),{trigger:!0})})},c=function(t){console.log("XF :: loadChildComponents",t),e(t).find("[data-component][data-cache=true],[data-component]:visible").each(function(t,a){var n=e(a).attr("data-id"),i=e(a).attr("data-component");d(n,i,!0)})},d=function(t,e){m(e,function(a){if(!u[t]){var n=new a(e,t);console.log("XF :: loadChildComponent - created : "+t),u[t]=n,n.construct()}})},p=function(){e("[data-component]").on("show",function(t){if(console.log("SHOWED",t.target),t.currentTarget==t.target){var a=e(this).attr("data-id");if(!u[a]){var n=e(this).attr("data-component");d(a,n)}o.trigger("ui:enhance",e(this))}})},h=function(t,e){var a=document.createElement("script");a.readyState?a.onreadystatechange=function(){("loaded"==a.readyState||"complete"==a.readyState)&&(a.onreadystatechange=null,e&&e())}:a.onload=function(){e&&e()},a.src=t,document.getElementsByTagName("head")[0].appendChild(a)},u={},f={},m=function(t,e){var a=f[t];return a||(a=o.registerComponent(t,o.Settings.property("componentUrlFormatter")(t))),a.loaded?(e(a.compDef),void 0):(a.callbacks.push(e),a.loading||(a.loading=!0,h(a.compSrc)),void 0)};o.getComponentByID=function(t){return u[t]},o.registerComponent=function(t,e){var a=f[t];return a?a:(f[t]=new v(e),f[t])},o.defineComponent=function(t,e){var a=f[t];for(a||(a=f[t]=new v(null)),f[t].loading=!1,f[t].loaded=!0,f[t].compDef=e;a.callbacks.length;)a.callbacks.pop()(a.compDef)},o.requireComponent=function(t,e){m(t,e)};var g={};o.setOptionsByID=function(t,e){g[t]=e},o.getOptionsByID=function(t){return g[t]||{}},o.history=a.history,o.Settings={options:{applicationVersion:"1.0.0",noCache:!1,componentUrlPrefix:"",componentUrlPostfix:".js",componentUrlFormatter:function(t){return o.Settings.property("componentUrlPrefix")+t+o.Settings.property("componentUrlPostfix")},templateUrlPrefix:"",templateUrlPostfix:".tmpl",templateUrlFormatter:function(t,e){return o.Settings.property("templateUrlPrefix")+e+t+o.Settings.property("templateUrlPostfix")},dataUrlPrefix:"",dataUrlPostfix:".json",dataUrlFormatter:function(t){return o.Settings.property("dataUrlPrefix")+t+o.Settings.property("dataUrlPostfix")}},getProperty:function(t){return this.options[t]},setProperty:function(t,e){this.options[t]=e},property:function(t,e){return void 0===e?this.getProperty(t):(this.setProperty(t,e),void 0)}},o.Component=function(t,e){this.name=t||"default_name",this.id=e||"default_id",this.rendered=!1;var a=function(){this.unbind("refresh",a),this.rendered=!0};this.bind("refresh",a);var n=this.options,i=o.getOptionsByID(this.id);this.options=_.defaults(i,n)},o.Component.template=null,o.Component.templateURL=!1,o.Component.templateLoaded=!1,o.Component.templateLoading=!1,o.Component.compiledTemplate=null,_.extend(o.Component.prototype,o.Events),_.extend(o.Component.prototype,{options:{},modelClass:o.Model,model:null,viewClass:o.View,view:null,construct:function(){var t=function(){this.view.unbind("construct",t),this.afterConstructView(),this.init(),this.trigger("init"),this.trigger("construct"),o.trigger("component:"+this.id+":constructed")},e=function(){this.model.unbind("construct",e),this.afterConstructModel(),this.beforeConstructView(),this.constructView(),this.view.bind("construct",t,this),this.view.construct()};this.beforeConstructModel(),this.constructModel(),this.model.bind("construct",e,this),this.model.construct(),this.childComponent=[]},selector:function(){return"[data-id="+this.id+"]"},beforeConstructView:function(){},constructView:function(){this.view&&this.view instanceof o.View||(this.viewClass?(this.view=new this.viewClass,this.view instanceof o.View||(this.view=new o.View)):this.view=new o.View),this.view.component=this},afterConstructView:function(){},beforeConstructModel:function(){},constructModel:function(){this.model&&this.model instanceof o.Model||(this.modelClass?(this.model=new this.modelClass,this.model instanceof o.Model||(this.model=new o.Model)):this.model=new o.Model),this.model.component=this},afterConstructModel:function(){},init:function(){this.refresh()},refresh:function(){var t=function(){this.model.unbind("refresh",t),this.view.refresh(),this.trigger("refresh")};this.model.bind("refresh",t,this),this.model.refresh()},ready:function(t){if(this.rendered)t();else{var e=function(){this.unbind("refresh",e),t()};this.bind("refresh",e,this)}}}),o.Component.extend=a.Model.extend;var v=function(t){this.compSrc=t,this.compDef=null,this.loading=!1,this.loaded=!1,this.callbacks=[]};o.Cache={storage:null,available:!1,init:function(){this.storage=t.localStorage;try{this.storage.setItem("check","check"),this.storage.removeItem("check"),this.available=!0}catch(e){this.available=!1}var a=this.get("applicationVersion");o.Settings.property("noCache")?(console.log("XF.Cache :: init - cache is disable for the whole app manually - clearing storage"),this.clear(),this.set("applicationVersion",o.Settings.property("applicationVersion"))):a&&a==o.Settings.property("applicationVersion")?console.log("XF.Cache :: init - same version is cached - useing it as much as possible"):(console.log("XF.Cache :: init - wrong or no version cached - clearing storage"),this.clear(),this.set("applicationVersion",o.Settings.property("applicationVersion")))},get:function(t){var e;if(this.available)try{e=this.storage.getItem(t),console.log('XF.Cache :: get - "'+t+'" = "'+e+'"')}catch(a){e=null}else e=null;return e},set:function(t,e){var a;if(this.available)try{this.storage.setItem(t,e),a=!0,console.log('XF.Cache :: set - "'+t+'" = "'+e+'"')}catch(n){a=!1}else a=!1;return a},clear:function(){var t;if(this.available)try{this.storage.clear(),t=!0,console.log("XF.Cache :: clear")}catch(e){t=!1}else t=!1;return t}},o.Device={size:{width:0,height:0},isMobile:/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino|1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test((navigator.userAgent||navigator.vendor||t.opera).toLowerCase()),types:[{name:"desktop",range:{max:null,min:1025},templatePath:"desktop/",fallBackTo:"tablet"},{name:"tablet",range:{max:1024,min:480},templatePath:"tablet/",fallBackTo:"mobile"},{name:"mobile",range:{max:480,min:null},templatePath:"mobile/",fallBackTo:"default"}],defaultType:{name:"default",range:{min:null,max:null},templatePath:"",fallBackTo:null},type:this.defaultType,init:function(t){this.types=t||this.types,this.detectType(),this.detectTouchable()},supports:{touchEvents:!1,pointerEvents:t.navigator.msPointerEnabled,cssAnimations:function(){var t="Webkit Moz O ms Khtml".split(" "),e=document.createElement("div");if(e.style.animationName)return{prefix:""};for(var a=0;t.length>a;a++)if(void 0!==e.style[t[a]+"AnimationName"])return{prefix:"-"+t[a].toLowerCase()+"-"};return!1}()},detectType:function(){this.size.width=e(t).width(),this.size.height=e(t).height(),console.log('XF.DeviceClass :: detectType - width = "'+this.size.width+'"'),console.log('XF.DeviceClass :: detectType - height = "'+this.size.height+'"');var a=Math.max(this.size.width,this.size.height);console.log('XF.DeviceClass :: detectType - maxSide = "'+a+'"');var n=null;_.each(this.types,function(t){try{(!t.range.min||t.range.min&&a>t.range.min)&&(!t.range.max||t.range.max&&t.range.max>a)&&(n=t)}catch(e){console.log("XF.DeviceClass :: detectType - bad type detected - skipping"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")}}),n?this.type=n:(this.type=this.defaultType,console.log("XF.DeviceClass :: detectType - could not choose any of device type"),console.log("XF.DeviceClass :: detectType - drop back to this.defaultType"),console.log("XF.DeviceClass :: detectType - @dev: plz verify types list")),console.log('XF.DeviceClass :: detectType - selected type "'+this.type.name+'"')},getNextType:function(t){var e=this.type;return t&&(e=t.fallBackTo?this.getTypeByName(t.fallBackTo):this.defaultType),e&&e.templatePath||(e=this.defaultType),e==t?(console.log("XF.DeviceClass :: getNextType - infinit cycle of drop down logic detected"),console.log("XF.DeviceClass :: getNextType - stop trying, no template is available"),null):e},getTypeByName:function(t){var e=null;return _.each(this.types,function(a){try{a.name==t&&(e=a)}catch(n){console.log("XF.DeviceClass :: getTypeByName - bad type name - skipping"),console.log("XF.DeviceClass :: getTypeByName - @dev: plz verify types list")}}),e},detectTouchable:function(){var e=" -webkit- -moz- -o- -ms- ".split(" "),a=["@media (",e.join("touch-enabled),("),"app_device_test",")","{#touch{top:9px;position:absolute}}"].join(""),n=this;this.injectElementWithStyles(a,function(e){var a=document.styleSheets[document.styleSheets.length-1],i=(a?a.cssRules&&a.cssRules[0]?a.cssRules[0].cssText:a.cssText||"":"",e.childNodes),o=i[0];n.supports.touchEvents="ontouchstart"in t||t.DocumentTouch&&document instanceof DocumentTouch||9===(o&&o.offsetTop)},1,["touch"]),console.log("XF.Device :: detectTouchable - device IS "+(this.supports.touchEvents?"":"NOT ")+"touchable")},injectElementWithStyles:function(t,e,a,n){var i,o,s,r=document.createElement("div"),l=document.body,c=l?l:document.createElement("body");if(parseInt(a,10))for(;a--;)s=document.createElement("div"),s.id=n?n[a]:"app_device_test"+(a+1),r.appendChild(s);return i=["&#173;","<style>",t,"</style>"].join(""),r.id="app_device_test",c.innerHTML+=i,c.appendChild(r),l||(c.style.background="",docElement.appendChild(c)),o=e(r,t),l?r.parentNode.removeChild(r):c.parentNode.removeChild(c),!!o},ORIENTATION_PORTRAIT:"portrait",ORIENTATION_LANDSCAPE:"landscape",getOrientation:function(){var t=!0,a=document.documentElement;return void 0!==e.support||(t=a&&1.1>a.clientWidth/a.clientHeight),t?this.ORIENTATION_PORTRAIT:this.ORIENTATION_LANDSCAPE},getScreenHeight:function(){var a=this.getOrientation(),n=a===this.ORIENTATION_PORTRAIT,i=n?480:320,o=n?screen.availHeight:screen.availWidth,s=Math.max(i,e(t).height()),r=Math.min(o,s);return r},getViewport:function(){var t=e("body").addClass("xf-viewport");return t[0]||(t=e(".xf-page").eq(0),t=t.length?t.parent():e("body"),t.addClass("xf-viewport")),t.eq(0)}},o.Model=a.Model.extend({component:null,rawData:null,dataURL:null,dataRequestSettings:null,isEmptyData:!1,isStaticData:!1,isStringData:!1,autoUpdateInterval:0,updateInBackground:!1,updateOnShow:!1,defaults:null,construct:function(){if(this.initialize(),this.trigger("init"),this.autoUpdateInterval>0){var t=_.bind(function(){e(this.component.selector()).is(":visible")?this.refresh():this.updateInBackground&&this.refresh()},this);setInterval(t,this.autoUpdateInterval)}this.updateOnShow&&e(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.trigger("construct")},refresh:function(){var t=function(){this.unbind("dataLoaded",t),this.component.view.renderVersion,this.afterLoadData(),this.trigger("refresh")};this.bind("dataLoaded",t),this.beforeLoadData(),this.loadData()},getDataURL:function(){if(!this.dataURL){if(!this.component)throw'XF.Model "component" linkage lost';this.dataURL=_.bind(o.Settings.property("dataUrlFormatter"),this)(this.component.name)}return this.dataURL},getDataRequestSettings:function(){return this.dataRequestSettings||{}},beforeLoadData:function(){},loadData:function(){if(this.isEmptyData||this.rawData&&this.isStaticData&&!(this.autoUpdate>0))this.trigger("dataLoaded");else{var t=this,a=this.getDataURL();e.ajax(_.extend(this.getDataRequestSettings(),{url:a,complete:function(e,a){if(!t.component)throw'XF.Model "component" linkage lost';t.rawData="success"==a?t.isStringData?e.responseText:JSON.parse(e.responseText):t.isStringData?{}:"",t.trigger("dataLoaded")}}))}},afterLoadData:function(){}}),o.Pages={pageClass:"xf-page",activePageClass:"xf-page-active",animations:{"default":"slideleft",next:null,types:{none:{fallback:function(){}},fade:{fallback:function(){}},slideleft:{fallback:function(){}},slideright:{fallback:function(){}}}},activePage:null,activePageName:"",init:function(t){o.on("pages:show",_.bind(o.Pages.show,o.Pages)),o.on("pages:animation:next",_.bind(o.Pages.setNextAnimationType,o.Pages)),o.on("pages:animation:default",_.bind(o.Pages.setDefaultAnimationType,o.Pages)),o.on("pages:start",_.bind(o.Pages.start,o.Pages)),_.has(t,"types")&&_.extend(this.animations.types,t.types),_.has(t,"default")&&this.setDefaultAnimationType(t.default),this.start()},start:function(t){t=t||e("body"),console.log("pages start",t);var a=t.find(" ."+this.pageClass);if(a.length){var n=a.filter("."+this.activePageClass);n.length?(this.activePage=n,this.activePageName=n.attr("id")):this.show(a.first())}},setDefaultAnimationType:function(t){o.Pages.animations.types[t]&&(o.Pages.animations.default=t)},setNextAnimationType:function(t){o.Pages.animations.types[t]&&(o.Pages.animations.next=t)},show:function(t,a){if(t!==this.activePageName){if(""===t){var i=n.find(" ."+this.pageClass);return i.length&&this.show(i.first()),void 0}var s=t instanceof e?t:e("."+o.Pages.pageClass+"#"+t);if((!this.activePage||s.attr("id")!=this.activePage.attr("id"))&&s.length){console.log("XF.Pages :: showing page",s.attr("id"));var r=o.Device.getViewport();o.Device.getScreenHeight(),this.animations.next?(a=this.animations.types[this.animations.next]?this.animations.next:this.animations.default,this.animations.next=null):a=this.animations.types[a]?a:this.animations.default;var l=this.activePage,d=s;if(this.activePage=d,this.activePageName=s.attr("id"),!o.Device.supports.cssAnimations&&_.isFunction(this.animations.types[a].fallback))return d.addClass(this.activePageClass),this.animations.types[a].fallback(l,d),void 0;l?(r.addClass("xf-viewport-transitioning"),l.height(r.height()).addClass("out "+a),d.height(r.height()).addClass("in "+a+" "+this.activePageClass),l.animationEnd(function(){l.height("").removeClass(a+" out in"),l.removeClass(o.Pages.activePageClass)}),d.animationEnd(function(){d.height("").removeClass(a+" out in"),r.removeClass("xf-viewport-transitioning")})):this.activePage.addClass(this.activePageClass),c(this.activePage[0]),o.trigger("ui:enhance",e(this.activePage[0]))}}}},o.Router=null,o.RouterClass=a.Router,_.extend(o.RouterClass.prototype,{start:function(){this.bindAnyRoute(),o.history.start()},bindAnyRoute:function(){this.on("route",function(){console.log("XF.Router :: route: ",this.getPageNameFromFragment(o.history.fragment)),o.Pages&&o.Pages.show(this.getPageNameFromFragment(o.history.fragment))})},getPageNameFromFragment:function(t){var e=t.replace(/^\/+/,"").replace(/\/+$/,"").split("/");return e[0]}}),o.Utils={},o.Utils.AddressBar={},_.extend(o.Utils.AddressBar,{BODY_SCROLL_TOP:!1,getScrollTop:function(){var e=t,a=document;return e.pageYOffset||"CSS1Compat"===a.compatMode&&a.documentElement.scrollTop||a.body.scrollTop||0},hide:function(){console.log("XF :: Utils :: AddressBar :: hide");var e=t;if(location.hash||o.Utils.AddressBar.BODY_SCROLL_TOP===!1||e.scrollTo(0,1===o.Utils.AddressBar.BODY_SCROLL_TOP?0:1),o.Device.isMobile){var a=document.documentElement.style;return a.height="200%",a.overflow="visible",t.scrollTo(0,1),a.height=t.innerHeight+"px",!0}},hideOnLoad:function(){console.log("XF :: Utils :: AddressBar :: hideOnLoad");var e=t,a=e.document;!location.hash&&e.addEventListener&&(t.scrollTo(0,1),o.Utils.AddressBar.BODY_SCROLL_TOP=1,bodycheck=setInterval(function(){a.body&&(clearInterval(bodycheck),o.Utils.AddressBar.BODY_SCROLL_TOP=o.Utils.AddressBar.getScrollTop())},15),e.addEventListener("load",function(){setTimeout(function(){20>o.Utils.AddressBar.getScrollTop()},0)}))}}),o.View=a.View.extend({component:null,templateURL:null,ignoreModelUpdate:!1,updateOnShow:!1,useCache:!1,construct:function(){var t=function(){return this.loadTemplateFailed?(this.unbind("templateLoaded",t),this.afterLoadTemplateFailed(),void 0):this.component.constructor.templateLoaded?(this.unbind("templateLoaded",t),this.afterLoadTemplate(),this.initialize(),this.trigger("init"),this.ignoreModelUpdate||this.component.model.bind("changed",this.refresh,this),this.updateOnShow&&e(this.component.selector()).bind("show",_.bind(this.refresh,this)),this.trigger("construct"),void 0):(this.loadTemplate(),void 0)};this.bind("templateLoaded",t),this.beforeLoadTemplate(),this.loadTemplate()},lastDeviceType:null,getTemplateURL:function(){if(this.lastDeviceType&&(this.templateURL=null),!this.templateURL){if(!this.component)throw'XF.View "component" linkage lost';if(this.lastDeviceType=o.Device.getNextType(this.lastDeviceType),!this.lastDeviceType)return null;var t="";this.lastDeviceType&&this.lastDeviceType.templatePath&&(t=this.lastDeviceType.templatePath),this.templateURL=o.Settings.property("templateUrlFormatter")(this.component.name,t)}return this.templateURL},getMarkup:function(){return this.component.constructor.compiledTemplate||(this.component.constructor.compiledTemplate=_.template(this.component.constructor.template)),this.component.constructor.compiledTemplate(this.component.model)},beforeLoadTemplate:function(){},loadTemplateFailed:!1,loadTemplate:function(){var t=this.getTemplateURL();if(null==t)return this.loadTemplateFailed=!0,this.trigger("templateLoaded"),void 0;if(this.useCache){var a=o.Cache.get(t);if(a)return this.component.constructor.template=a,this.component.constructor.templateLoaded=!0,this.trigger("templateLoaded"),void 0}if(this.component.constructor.templateLoaded||this.component.constructor.templateLoading)if(this.component.constructor.templateLoading){var n=this;t=this.component.constructor.templateURL;var i=function(e){e.url==t&&(o.unbind("templateLoaded",i),n.trigger("templateLoaded"))};o.bind("templateLoaded",i)}else this.trigger("templateLoaded");else{this.component.constructor.templateURL=t,this.component.constructor.templateLoading=!0;var n=this;e.ajax({url:t,complete:function(e,a){if(!n.component)throw'XF.View "component" linkage lost';if("success"==a){var i=e.responseText;n.useCache&&o.Cache.set(t,i),n.component.constructor.template=e.responseText,n.component.constructor.templateLoading=!1,n.component.constructor.templateLoaded=!0,n.trigger("templateLoaded"),o.trigger("templateLoaded",{url:t,template:i})}else n.component.constructor.template=null,n.component.constructor.templateLoading=!1,n.component.constructor.templateLoaded=!1,n.trigger("templateLoaded"),o.trigger("templateLoaded",{url:t,template:null})}})}},afterLoadTemplate:function(){},afterLoadTemplateFailed:function(){console.log('XF.View :: afterLoadTemplateFailed - could not load template for "'+this.component.id+'"'),console.log("XF.View :: afterLoadTemplateFailed - @dev: verify XF.Device.types settings & XF.View :: getTemplate URL overrides")},refresh:function(){this.preRender(),this.render(),this.postRender(),this.trigger("refresh")},preRender:function(){},renderVersion:0,render:function(){this.renderVersion++;var t=e("[data-id="+this.component.id+"]");t.html(this.getMarkup()),o.trigger("ui:enhance",t)},postRender:function(){}});var b,x,y={},w={mouse:{start:"mousedown",move:"mousemove",end:"mouseup",cancel:"mouseup"},pointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp",cancel:"MSPointerCancel"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"}},C=30;b=o.Device.pointerEvents?!1:o.Device.touchEvents?!0:!1,x=o.Device.pointerEvents?"pointer":o.Device.touchEvents?"touch":"mouse";var T=function(t){return"tagName"in t?t:t.parentNode},k=function(t,e,a,n){var i=Math.abs(t-e),o=Math.abs(a-n);return i>=o?t-e>0?"Left":"Right":a-n>0?"Up":"Down"},P=function(){y={}};e(document).ready(function(){var a,n;e(document.body).bind(w[x].start,function(t){a=Date.now(),n=a-(y.last||a),y.el=e(T(t.target)),y.x1=b?t.originalEvent.targetTouches[0].pageX:t.pageX,y.y1=b?t.originalEvent.targetTouches[0].pageY:t.pageY,y.last=a}).bind(w[x].move,function(t){y.x2=b?t.originalEvent.targetTouches[0].pageX:t.pageX,y.y2=b?t.originalEvent.targetTouches[0].pageY:t.pageY,Math.abs(y.x1-y.x2)>10&&t.preventDefault()}).bind(w[x].end,function(){y.x2&&Math.abs(y.x1-y.x2)>C||y.y2&&Math.abs(y.y1-y.y2)>C?(y.direction=k(y.x1,y.x2,y.y1,y.y2),y.el.trigger("swipe"),y.el.trigger("swipe"+y.direction),y={}):"last"in y&&(y.el.trigger("tap"),e(document.body).unbind("click"),y.el.unbind("click"))}).bind(w[x].cancel,P),e(t).bind("scroll",P)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","tap"].forEach(function(t){e.fn[t]=function(e){return this.bind(t,e)}});var U=e.fn.hide;e.fn.hide=function(){var t=U.apply(this,arguments);return e(this).trigger("hide"),t};var I=e.fn.show;e.fn.show=function(){var t=I.apply(this,arguments);return e(this).trigger("show"),t};var D=e.fn.html;e.fn.html=function(){var t=D.apply(this,arguments);return e(this).trigger("show"),e(this).trigger("html"),t};var L=e.fn.append;e.fn.append=function(){var t=L.apply(this,arguments);return e(this).trigger("append"),t};var N=e.fn.prepend;e.fn.prepend=function(){var t=N.apply(this,arguments);return e(this).trigger("prepend"),t},e.fn.animationEnd=function(t){var a="webkitAnimationEnd oAnimationEnd msAnimationEnd animationend";return e(this).one(a,t),this},_.isFunction(e.fn.detach)||(e.fn.detach=function(t){return this.remove(t,!0)}),_.isFunction(e.fn.wrapInner)||(e.fn.wrapInner=function(t){return _.isFunction(t)?this.each(function(a){e(this).wrapInner(t.call(this,a))}):this.each(function(){var a=e(this),n=a.contents();n.length?n.wrapAll(t):a.append(t)})});var F=e.fn.detach;e.fn.detach=function(){var t=e(this).parent(),a=F.apply(this,arguments);return t.trigger("detach"),a},e.fn.outerHtml=function(t){if(t)return this.each(function(){e(this).replaceWith(t)});var a=e("<div></div>").append(e(this).clone()),n=a.html();return a.remove(),n},o.UI={},_.extend(o.UI,{init:function(){o.on("ui:enhance",_.bind(o.UI.enhance,o.UI))},enhance:function(t){!t instanceof e&&(t=e(t),!t instanceof e)||_.each(o.UI,function(a){"object"==typeof a&&a.hasOwnProperty("selector")&&t.find(a.selector).not("[data-skip-enhance=true]").each(function(){var t=!1;_.each(o.UI.enhanced.length,function(){o.UI.enhanced[i]===this&&(t=!0)}),!t&"true"!=e(this).attr("data-skip-enhance")&&(o.UI.enhanced.push(this),a.render(this))})})},enhanced:[],issetElements:[],checkInIsset:function(t,e){t=t||"",e=e||"";var a=[];for(var n in this.issetElements)""===e?this.issetElements[n].type===t&&a.push(this.issetElements[n].id):this.issetElements[n].type===t&&this.issetElements[n].id===e&&a.push(this.issetElements[n].id);return a},removeFromIsset:function(t,e){t=t||"",e=e||"";var a=[];for(var n in this.issetElements)""===e?this.issetElements[n].type!==t&&a.push(this.issetElements[n]):this.issetElements[n].type!==t&&this.issetElements[n].id!==e&&a.push(this.issetElements[n]);this.issetElements=a}}),o.UI.button={selector:"A[data-role=button], BUTTON, INPUT[type=submit], INPUT[type=reset], INPUT[type=button], [data-appearance=backbtn]",render:function(t){var a,n,i=e(t);if(t&&!(!i instanceof e)&&"true"!=i.attr("data-skip-enhance")){if("A"==t.nodeName||"BUTTON"==t.nodeName)a=i.attr({"data-skip-enhance":!0}),n=i.html(),i.html("");else{if("INPUT"!=t.nodeName)return;a=e("<div></div>").append(i.clone().addClass("xf-input-hidden").attr({"data-skip-enhance":!0})),i.outerHtml(a),n=i.attr("value")}var o="true"==i.attr("data-small")||"backbtn"==i.attr("data-appearance");a.addClass(o?"xf-button-small":"xf-button"),"backbtn"===i.attr("data-appearance")&&a.addClass("xf-button-back");var s=i.attr("data-icon");if("backbtn"===i.attr("data-appearance")&&(s="left"),s){var r=e("<span class=xf-icon></span>");r.addClass("xf-icon-"+s),o?r.addClass("xf-icon-small"):r.addClass("xf-icon-big");var l=i.attr("data-iconpos")||"left";"left"!=l&&"right"!=l&&"top"!=l&&"bottom"!=l&&(l="left"),a.addClass("xf-iconpos-"+l),a.append(r)}if(n){var c=e("<span></span>").append(n);o||"backbtn"==i.attr("data-appearance")?c.addClass("xf-button-small-text"):c.addClass("xf-button-text"),a.append(c)}"true"==i.attr("data-special")&&a.addClass("xf-button-special"),"true"==i.attr("data-alert")&&a.addClass("xf-button-alert"),"true"==i.attr("data-alert")&&a.addClass("xf-button-alert")}},create:function(t){var a=e("<button>/button>"),n={};return a.html(t.text),t.icon&&""!=t.icon&&(n["data-icon"]=t.icon),t.iconpos&&""!=t.iconpos&&(n["data-iconpos"]=t.iconpos),t.small&&""!=t.small&&(n["data-small"]=t.small),t.appearance&&""!=t.appearance&&(n["data-appearance"]=t.appearance),t.special&&""!=t.special&&(n["data-special"]=t.special),t.alert&&""!=t.alert&&(n["data-alert"]=t.alert),_.isFunction(t.handler)&&a.click(t.handler),a.attr(n),this.render(a[0]),a}},o.UI.checkboxRadio={selector:"INPUT[type=checkbox], INPUT[type=radio]",render:function(t){var a=e(t),n={id:"",input:"",wrapperClass:"",labelClass:"",labelFor:"",isSwitch:!1,label:""};if(t&&!(!a instanceof e)&&"true"!=a.attr("data-skip-enhance")){a.attr({"data-skip-enhance":!0}),n.id=a.attr("id")||"xf-"+Math.floor(1e4*Math.random()),n.input=a.wrap("<span></span>").parent().html(),a.attr("id",n.id);var i=e("label[for="+n.id+"]");if(i.length){var o=a.attr("type").toLowerCase(),s=e("<div></div>"),r=n.isSwitch="switch"==a.attr("data-role");r?(n.wrapperClass="xf-switch",n.labelClass="xf-switch-control",i.addClass("xf-switch-label")):(n.wrapperClass="xf-input-"+o,n.labelClass="xf-input-positioner",i.addClass("xf-input-label")),s.append(i),n.labelFor=i.wrap("<span></span>").parent().html();var l=_.template('<div class="<%= options.wrapperClass %>"><label for="<%= options.id %>" class="<%= options.labelClass %>"><%= options.input %><% if(options.isSwitch) { %><span class=xf-switch-track><span class=xf-switch-track-wrap><span class=xf-switch-thumb></span></span></span><% } %></label><%= options.labelFor %></div>');a.parent().html(l({options:n}))}}}},o.UI.fieldset={selector:"fieldset[data-role=controlgroup]",render:function(t){var a=e(t);if(t&&!(!a instanceof e)&&"true"!=a.attr("data-skip-enhance")){var n=a.attr("id")||"xf-"+Math.floor(1e4*Math.random());a.attr({"data-skip-enhance":!0,id:n}),a.addClass("xf-controlgroup");var i=a.children("legend").detach();if(a.wrapInner('<div class="xf-controlgroup-controls">'),a.prepend(i),i.length){var o=e("<div></div>"),s={};_.each(i[0].attributes,function(t){s[t.name]=t.value}),o.attr(s).addClass("xf-label").html(i.html()),i.outerHtml(o.outerHtml())}}}},o.UI.list={selector:"UL[data-role=listview], OL[data-role=listview]",render:function(t){var a=e(t);if(t&&!(!a instanceof e)&&"true"!=a.attr("data-skip-enhance")){var n=a.children("li"),i=n.children("a"),o=[],s=a.attr("data-fullwidth")||"false",r=a.attr("id")||"xf-"+Math.floor(1e4*Math.random());i.addClass("xf-li-btn").children(".xf-count-bubble").parent().addClass("xf-li-has-count"),n.not(i.parent()).not("[data-role=divider]").addClass("xf-li-static"),a.attr({"data-skip-enhance":!0,id:r}).addClass("xf-listview").children("li[data-icon]").children("a").each(function(){var t=e(this),a=t.parent().attr("data-icon");t.append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-"+a));var n=t.parent().attr("data-iconpos");"left"!=n&&"right"!=n&&(n="right"),t.addClass("xf-li-with-icon-"+n)}),"true"===s&&a.addClass("xf-listview-fullwidth"),i.children("img").parent().each(function(){var t=e(this),a=t.parent().attr("data-thumbpos");"right"!=a&&"left"!=a&&(a="left"),t.addClass("xf-li-with-thumb-"+a),t.children("img").addClass("xf-li-thumb xf-li-thumb-"+a)}),i.each(function(){var t=e(this);t.append(e("<div class=xf-btn-text></div>").append(t.children().not(".xf-icon, .xf-count-bubble, .xf-li-thumb")))}),n.find("h1, h2, h3, h4, h5, h6").addClass("xf-li-header"),n.find("p").addClass("xf-li-desc"),n.filter(".xf-li-static").each(function(){e(this).wrapInner("<div class=xf-li-wrap />")}),e.each(n,function(t){var e=n.eq(t).html(),a=n.eq(t).attr("data-role")||"",i=(n.eq(t).attr("class")||"")+" xf-li",s=n.eq(t).attr("id")||"";""!==a&&(i+=" xf-li-"+a),o.push({html:e,"class":i,id:s})});var l=_.template('<% _.each(listItemsScope, function(item) { %> <li class="<%= item.class %>" id="<%= item.id %>"><%= item.html %></li><% }); %>');a.html(l({listItemsScope:o}))}}},o.UI.popup={Create:function(){var t="xf-"+Math.floor(1e4*Math.random()),a=o.UI.checkInIsset("popup"),n=!1;for(var i in a)n&&(e("#"+a[i]).length||(t=a[i],n=!0));n||o.UI.issetElements.push({type:"popup",id:t});var s=e('<div class="xf-dialog " id="'+t+'"><div class="xf-dialog-content"></div></div>');return s},showDialog:function(t,e,a){var n=this.createDialog(t,e,a);this.show(n)},show:function(t){o.Device.getViewport().append(t)},hide:function(t){t.detach(),o.UI.removeFromIsset("popup",t.attr("id"))},createDialog:function(t,a,n){var i=this.create(),s=_.template('<div class="xf-dialog-box"><div class="xf-dialog-box-header"><h3><%= headerText %></h3></div><div class="xf-dialog-box-content"><%= messageText %></div><div class="xf-dialog-box-footer clearfix"></div></div>');i.find(".xf-dialog-content").html(s({headerText:t,messageText:a}));
var r=i.find(".xf-dialog-box-footer");if(n||(n=[{text:"OK",handler:function(){this.hide(i)}}]),n){var l,c=n.length;_.each(n,function(t){l=t instanceof e?t:o.UI.button.create(t),r.append(e("<div></div>").addClass("xf-grid-unit xf-grid-unit-1of"+c).append(l))})}return this.dialog=i,i},createNotification:function(t,a){var n=this.create().addClass("xf-dialog-notification"),i=_.template('<div class="xf-notification"><div class="xf-notification-wrap"><div class="xf-notification-text"><%= messageText %></div></div></div>');return n.find(".xf-dialog-content").html(i({messageText:t})),a&&""!=a&&n.find(".xf-notification-wrap").prepend(e("<div></div>").addClass("xf-notification-icon").append(e("<span></span>").addClass("xf-icon xf-icon-xl xf-icon-"+a))),n},loadingNotification:null,dialog:null,setLoadingNotification:function(t){this.loadingNotification=t},showLoading:function(t,e){(t||e)&&(this.loadingNotification&&this.hideLoading(),this.setLoadingNotification(this.createNotification(t,e))),this.loadingNotification&&this.setLoadingNotification(this.createNotification("Loading...")),this.show(this.loadingNotification)},hideLoading:function(){this.loadingNotification&&this.hide(this.loadingNotification)},hideDialog:function(){this.dialog&&this.hide(this.dialog)},hideAll:function(){var t=o.UI.checkInIsset("popup");for(var a in t)e("#"+t[a]).length&&this.hide(e("#"+t[a]))}},o.UI.scrollable={selector:"[data-scrollable=true]",render:function(t){var a=e(t);if(t&&!(!a instanceof e)&&"true"!=a.attr("data-skip-enhance")){var n=a.attr("id")||"xf-"+Math.floor(1e4*Math.random());a.attr({"data-skip-enhance":!0,id:n});var i=a.children();a.append(e("<div></div>").addClass("xf-scrollable-content").append(i));var o=a.attr("id");o&&""!=o||(o="xf_scrollable_"+(new Date).getTime(),a.attr({id:o}));var s=a.data("iscroll",new iScroll(o)),r=!1,l=function(){r&&(r=!1,s.data("iscroll").refresh(),d())},c=function(){e.contains(e("#"+o)[0],this)&&(r=!0,setTimeout(l,100))},d=function(){e("#"+o+" *").bind("detach",c).bind("hide",c).bind("show",c).bind("append",c).bind("prepend",c).bind("html",c).bind("resize",c)};d()}}},o.UI.input={selector:"INPUT[type=text], INPUT[type=search], INPUT[type=tel], INPUT[type=url], INPUT[type=email], INPUT[type=password], INPUT[type=datetime], INPUT[type=date], INPUT[type=month], INPUT[type=week], INPUT[type=time], INPUT[type=datetime-local], INPUT[type=number], INPUT[type=color], TEXTAREA, INPUT[type=range], INPUT[type=search]",render:function(t){var a=e(t);if(t&&!(!a instanceof e)&&"true"!=a.attr("data-skip-enhance")){a.attr({"data-skip-enhance":!0}),a.addClass("xf-input-text");var n="INPUT"==t.nodeName,i=a.attr("type");if("search"==i){var o=e('<input type="text"/>'),s={};_.each(t.attributes,function(t){"type"!=t.name&&(s[t.name]=t.value)}),o.attr(s),a.outerHtml(o),a=o,t=o[0]}else if("number"==i||"range"==i){var r=a.attr("min"),l=a.attr("max"),c=parseFloat(a.attr("value")),d=parseFloat(a.attr("step"))||1,o=e('<input type="text"/>'),s={};_.each(t.attributes,function(t){"type"!=t.name&&(s[t.name]=t.value)}),o.attr(s),o.attr({"data-skip-enhance":!0});var p=e("<div></div>").addClass("xf-input-number");p.append(e('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-decrease").attr({"data-skip-enhance":!0}).append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-minus-circled"))),p.append(o),p.append(e('<button type="button"></button>').addClass("xf-input-number-control xf-input-number-control-increase").attr({"data-skip-enhance":!0}).append(e("<span></span>").addClass("xf-icon xf-icon-big xf-icon-plus-circled")));var h=null;if("number"==i)a.outerHtml(p),a=p,t=p[0];else if("range"==i&&(h=e("<div></div>").addClass("xf-range"),h.append(p),(r||0===r)&&(l||0===l))){r=parseFloat(r),l=parseFloat(l);var u=_.template('<div class="xf-input-range"><div class="xf-range-wrap"><div class="xf-input-range-min"><%= minValue %></div><div class="xf-input-range-slider"><div class="xf-input-range-track"><div class="xf-input-range-value" style="width: 30%"><div class="xf-input-range-control" tabindex="0"><div class="xf-input-range-thumb" style="left:100%" title="<%= selValue %>"></div></div></div></div></div><div class="xf-input-range-max"><%= maxValue %></div></div></div>');h.append(u({minValue:r,maxValue:l,selValue:c})),a.outerHtml(h),a=h,t=h[0]}var f=function(t){var e=t%d,a=t-e;if(e>d/2&&(a+=d),t=a,(l||0===l)&&t>l&&(t=l),(r||0===r)&&r>t&&(t=r),c=t,o.attr({value:t}),h){h.find("div.xf-input-range-thumb").attr({title:t});var n=100*(t-r)/(l-r);h.find("div.xf-input-range-value").css({width:""+n+"%"})}},m=function(){var t=parseFloat(o.attr("value"));t+=d,f(t)},g=function(){var t=parseFloat(o.attr("value"));t-=d,f(t)};p.find("button.xf-input-number-control-decrease").click(g),p.find("button.xf-input-number-control-increase").click(m);var v,b=o.attr("value"),x=function(){v=o.attr("value"),b!=v&&(v=parseFloat(v),isNaN(v)&&(v=r),b=v,f(v))};if(o.change(x).focus(x).focusout(x),h){var y,w,C,T,k,P=void 0,U=function(t){return P||(P=h.find("div.xf-input-range-track")[0].clientWidth),t/P*(l-r)},I=function(t){return U(t)+r},D=function(){C=event.pageX||event.clientX||layerX||event.screenX,y=c,e(document).bind("mouseup",N),e(document).bind("mousemove",L)},L=function(){T=event.pageX||event.clientX||layerX||event.screenX,k=T-C,w=U(k),C=T,y+=w,f(y)},N=function(){e(document).unbind("mouseup",N),e(document).unbind("mousemove",L)},F=function(){e(document).bind("keydown",E)},E=function(t){switch(t.keyCode){case 33:f(c+3*d);break;case 34:f(c-3*d);break;case 35:f(l);break;case 36:f(r);break;case 38:case 39:f(c+d);break;case 37:case 40:f(c-d)}},S=function(){e(document).unbind("keydown",E)};h.find("div.xf-input-range-thumb").bind("mousedown",D),h.find("div.xf-input-range-control").bind("focus",F).bind("focusout",S);var R=function(t){t.target!=h.find("div.xf-input-range-thumb")[0]&&f(I(t.offsetX))};h.find("div.xf-input-range-track").bind("click",R)}}var X=!1;if("split"==a.attr("data-appearance")&&n){var O=["text","search","tel","url","email","password","datetime","date","month","week","time","datetime-local","color"];_.each(O,function(t){i==t&&(X=!0)})}var M="INPUT"===a[0].nodeName?a.attr("id"):a.find("input").eq(0).attr("id"),A=M.length?e("label[for="+M+"]"):[];if(A.length)if(X){a.removeClass("xf-input-text").addClass("xf-input-split-input"),A.addClass("xf-input-split-label");var B=e("<div></div>").addClass("xf-input-split");B.append(e("<div></div>").addClass("xf-grid-unit xf-input-split-part1").append(A)),B.append(e("<div></div>").addClass("xf-grid-unit xf-input-split-part2").append(a.clone())),a.outerHtml(B),a=B,t=B[0]}else A.addClass("xf-label")}}}}).call(this,window,$,Backbone);